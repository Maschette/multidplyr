<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>An introduction to multidplyr • multidplyr</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="../tidyverse.css" rel="stylesheet">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../tidyverse-2.css" rel="stylesheet">
<meta property="og:title" content="An introduction to multidplyr">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- google analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script><script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-115082821-1');
</script>
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">multidplyr</a>
        <div class="info">
          <span class="partof">part of the <a href="https://tidyverse.org">tidyverse</a></span>
          <span class="version version-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/multidplyr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
        <li>
  <a href="https://github.com/tidyverse/multidplyr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>An introduction to multidplyr</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tidyverse/multidplyr/blob/master/vignettes/multidplyr.Rmd"><code>vignettes/multidplyr.Rmd</code></a></small>
      <div class="hidden name"><code>multidplyr.Rmd</code></div>

    </div>

    
    
<p>multidplyr is a new backend for dplyr. You continue to use the dplyr verbs that you’re familiar with, but instead of the computation happening on one core it’s spread across multiple cores. You effectively create a local cluster on your computer, and then multidplyr takes care of telling each node what to do.</p>
<div id="basics" class="section level2">
<h2 class="hasAnchor">
<a href="#basics" class="anchor"></a>Basics</h2>
<p>multiplyr is built on the principle that moving data around is expensive so you want to do it as little as possible. The basic sequence of operations is:</p>
<ol style="list-style-type: decimal">
<li><p>Call <code><a href="../reference/partition.html">partition()</a></code> to split your dataset across multiple cores. This makes a partitioned data frame, or a party df for short.</p></li>
<li><p>Each dplyr verb applied to a party df performs the operation independently on each core. It leaves each result on each core, and returns another party df.</p></li>
<li><p>When you’re done with the expensive operations that need to be done on each core, you call <code><a href="https://dplyr.tidyverse.org/reference/compute.html">collect()</a></code> to retrieve the data and bring it back to your local computer.</p></li>
</ol>
<p>Let’s see a simple example of that using the <code><a href="https://www.rdocumentation.org/packages/nycflights13/topics/flights">nycflights13::flights</a></code>. This dataset contains information for about ~300,000 flights departing New York City in 2013.</p>
<p>We start by loading the packages we need:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(multidplyr)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr, <span class="dt">warn.conflicts =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(nycflights13)</a></code></pre></div>
<p>Next, we partition the flights data by destination, compute the average delay per flight, and then collect the results:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">flights1 &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(dest) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/partition.html">partition</a></span>()</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="co">#&gt; Initialising 2 core cluster.</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3">flights2 &lt;-<span class="st"> </span>flights1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span>(<span class="dt">dep_delay =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">flights3 &lt;-<span class="st"> </span>flights2 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/compute.html">collect</a></span>()</a></code></pre></div>
<p>The dplyr code looks the same as usual, but behind the scenes things are very different. <code>flights1</code> and <code>flights2</code> are party dfs. These look like normal data frames, but have an additional attribute: the number of shards. In this example, it tells us that <code>flights2</code> is spread across seven nodes, and the size on each node varies from 12 to 25 rows. <code><a href="../reference/partition.html">partition()</a></code> always makes sure a group is kept together on one node.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">flights2</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="co">#&gt; Source: party_df [105 x 2]</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="co">#&gt; Shards: 2 [47--58 rows]</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="co">#&gt; # Description: party_df</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="co">#&gt;   dest  dep_delay</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="co">#&gt;   &lt;chr&gt;     &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="co">#&gt; 1 ABQ       13.7 </span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="co">#&gt; 2 ALB       23.6 </span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="co">#&gt; 3 AUS       13.0 </span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11"><span class="co">#&gt; 4 AVL        8.19</span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="co">#&gt; 5 BDL       17.7 </span></a>
<a class="sourceLine" id="cb3-13" data-line-number="13"><span class="co">#&gt; 6 BGR       19.5 </span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14"><span class="co">#&gt; # … with 99 more rows</span></a></code></pre></div>
</div>
<div id="performance" class="section level2">
<h2 class="hasAnchor">
<a href="#performance" class="anchor"></a>Performance</h2>
<p>For this size of data, with a simple transformation, using a local cluster actually makes performance much slower!</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">by_dest &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(dest)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="co"># Local computation</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.time">system.time</a></span>(by_dest <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)))</a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co">#&gt;    user  system elapsed </span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co">#&gt;   0.007   0.000   0.007</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co"># Remote: partitioning</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.time">system.time</a></span>(flights2 &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/partition.html">partition</a></span>())</a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="co">#&gt;    user  system elapsed </span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="co">#&gt;   0.434   0.119   0.616</span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="co"># Remote: computation</span></a>
<a class="sourceLine" id="cb4-13" data-line-number="13"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.time">system.time</a></span>(flights3 &lt;-<span class="st"> </span>flights2 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)))</a>
<a class="sourceLine" id="cb4-14" data-line-number="14"><span class="co">#&gt;    user  system elapsed </span></a>
<a class="sourceLine" id="cb4-15" data-line-number="15"><span class="co">#&gt;   0.016   0.001   0.074</span></a>
<a class="sourceLine" id="cb4-16" data-line-number="16"><span class="co"># Remote: retrieve results</span></a>
<a class="sourceLine" id="cb4-17" data-line-number="17"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.time">system.time</a></span>(flights3 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/compute.html">collect</a></span>())</a>
<a class="sourceLine" id="cb4-18" data-line-number="18"><span class="co">#&gt;    user  system elapsed </span></a>
<a class="sourceLine" id="cb4-19" data-line-number="19"><span class="co">#&gt;   0.010   0.000   0.093</span></a></code></pre></div>
<p>That’s because there’s some overhead associated with sending the data to each node and retrieving the results at the end. For basic dplyr verbs, multidplyr is unlikely to give you significant speed ups unless you have 10s or 100s of millions of data points. It might however, if you’re doing more complex things with <code><a href="https://dplyr.tidyverse.org/reference/do.html">do()</a></code>. Let’s see how that plays out.</p>
<p>We’ll start by selecting a subset of flights that have at least 50 occurences, and we’ll compute the day of the year from the date:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">common_dest &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/tally.html">count</a></span>(dest) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(n <span class="op">&gt;=</span><span class="st"> </span><span class="dv">365</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/join.html">semi_join</a></span>(flights, .) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">yday =</span> lubridate<span class="op">::</span><span class="kw"><a href="http://lubridate.tidyverse.org/reference/day.html">yday</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/ISOdatetime">ISOdate</a></span>(year, month, day)))</a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="co">#&gt; Joining, by = "dest"</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/dim">dim</a></span>(common_dest)</a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="co">#&gt; [1] 332942     20</span></a></code></pre></div>
<p>That leaves us with ~332,000 observations.</p>
<p>This time, instead of allowing multidplyr to create a local cluster, we’ll do it ourselves. The <code><a href="../reference/new_cluster.html">new_cluster()</a></code> function creates a number of workers.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">cluster &lt;-<span class="st"> </span><span class="kw"><a href="../reference/new_cluster.html">new_cluster</a></span>(<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">cluster</a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="co">#&gt; 2 session cluster [..]</span></a></code></pre></div>
<p>If you want, you can use <code><a href="../reference/default_cluster.html">set_default_cluster()</a></code> so that <code><a href="../reference/partition.html">partition()</a></code> will use this cluster by default:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw"><a href="../reference/default_cluster.html">set_default_cluster</a></span>(cluster)</a></code></pre></div>
<p>Let’s partition our restricted flights data across this cluster:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">by_dest &lt;-<span class="st"> </span>common_dest <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/partition.html">partition</a></span>(dest)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">by_dest</a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="co">#&gt; Source: party_df [332,942 x 20]</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="co">#&gt; Shards: 2 [164,539--168,403 rows]</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="co">#&gt; # Description: party_df</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="co">#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time</span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;</span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="co">#&gt; 1  2013     1     1      517            515         2      830</span></a>
<a class="sourceLine" id="cb8-10" data-line-number="10"><span class="co">#&gt; 2  2013     1     1      533            529         4      850</span></a>
<a class="sourceLine" id="cb8-11" data-line-number="11"><span class="co">#&gt; 3  2013     1     1      542            540         2      923</span></a>
<a class="sourceLine" id="cb8-12" data-line-number="12"><span class="co">#&gt; 4  2013     1     1      554            558        -4      740</span></a>
<a class="sourceLine" id="cb8-13" data-line-number="13"><span class="co">#&gt; 5  2013     1     1      555            600        -5      913</span></a>
<a class="sourceLine" id="cb8-14" data-line-number="14"><span class="co">#&gt; 6  2013     1     1      558            600        -2      753</span></a>
<a class="sourceLine" id="cb8-15" data-line-number="15"><span class="co">#&gt; # … with 3.329e+05 more rows, and 13 more variables: sched_arr_time &lt;int&gt;,</span></a>
<a class="sourceLine" id="cb8-16" data-line-number="16"><span class="co">#&gt; #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb8-17" data-line-number="17"><span class="co">#&gt; #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb8-18" data-line-number="18"><span class="co">#&gt; #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, yday &lt;dbl&gt;</span></a></code></pre></div>
<p>It’s always a good idea to check the evenness of the partition - you’ll get the most benefit when the rows are roughly even across all of the nodes.</p>
<p>Let’s fit a smoothed generalised additive model to each destination, estimating how delays vary over the course of the year and within a day. Note that we need to use <code><a href="../reference/cluster_utils.html">cluster_library()</a></code> to load the mgcv package on every node. That takes 3.7s:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw"><a href="../reference/cluster_utils.html">cluster_library</a></span>(cluster, <span class="st">"mgcv"</span>)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.time">system.time</a></span>({</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">  models &lt;-<span class="st"> </span>by_dest <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="st">    </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/do.html">do</a></span>(<span class="dt">mod =</span> <span class="kw">gam</span>(dep_delay <span class="op">~</span><span class="st"> </span><span class="kw">s</span>(yday) <span class="op">+</span><span class="st"> </span><span class="kw">s</span>(dep_time), <span class="dt">data =</span> .))</a>
<a class="sourceLine" id="cb9-5" data-line-number="5">})</a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="co">#&gt;    user  system elapsed </span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7"><span class="co">#&gt;   0.018   0.000   3.752</span></a></code></pre></div>
<p>Compared with ~5.6s doing it locally:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.time">system.time</a></span>({</a>
<a class="sourceLine" id="cb10-2" data-line-number="2">  models &lt;-<span class="st"> </span>common_dest <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="st">    </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(dest) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="st">    </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/do.html">do</a></span>(<span class="dt">mod =</span> <span class="kw">gam</span>(dep_delay <span class="op">~</span><span class="st"> </span><span class="kw">s</span>(yday) <span class="op">+</span><span class="st"> </span><span class="kw">s</span>(dep_time), <span class="dt">data =</span> .))</a>
<a class="sourceLine" id="cb10-5" data-line-number="5">})</a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="co">#&gt;    user  system elapsed </span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="co">#&gt;   5.384   0.174   5.563</span></a></code></pre></div>
<p>That’s not a great speed up, but generally you don’t care about parallelising things that only take a couple of seconds. The cost of transmitting messages to the nodes is roughly fixed, so the longer the task you’re parallelising, the closer to a linear speed up you’ll get. It’ll also speed up with more nodes, but unfortunately vignettes are only allowed to use 2 nodes max, so I can’t show you that here.</p>
</div>
<div id="efficiency" class="section level2">
<h2 class="hasAnchor">
<a href="#efficiency" class="anchor"></a>Efficiency</h2>
<p>For the best performance, you’ll want to avoid loading all the data in the host process, and then sending it to individual workers. Instead, it’s more efficient (but harder!) for each worker to load the data directly.</p>
<p>For example, if you were reading in many csv files, your code might look something like this:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">cluster &lt;-<span class="st"> </span><span class="kw"><a href="../reference/new_cluster.html">new_cluster</a></span>(<span class="dv">4</span>)</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="kw"><a href="../reference/cluster_utils.html">cluster_assign_each</a></span>(cluster, <span class="st">"filename"</span>,</a>
<a class="sourceLine" id="cb11-3" data-line-number="3">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="st">"a.csv"</span>, <span class="st">"b.csv"</span>, <span class="st">"c.csv"</span>, <span class="st">"d.csv"</span>)</a>
<a class="sourceLine" id="cb11-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="kw"><a href="../reference/cluster_utils.html">cluster_assign</a></span>(cluster, <span class="st">"my_data"</span>, vroom<span class="op">::</span><span class="kw">vroom</span>(filename))</a>
<a class="sourceLine" id="cb11-6" data-line-number="6"></a>
<a class="sourceLine" id="cb11-7" data-line-number="7">my_data &lt;-<span class="st"> </span><span class="kw"><a href="../reference/party_df.html">party_df</a></span>(cluster, <span class="st">"my_data"</span>)</a></code></pre></div>
</div>
<div id="limitations" class="section level2">
<h2 class="hasAnchor">
<a href="#limitations" class="anchor"></a>Limitations</h2>
<ul>
<li>For optimal speedup, each node needs to do about the same amount of work. That generally means you want to group by a variable that divides the data up into many pieces, so each node can get about the same amount of data. If multidplyr’s default strategy isn’t a good fit for your data, you may need to make your own grouping variable which takes values from 1 to the number of nodes.</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#basics">Basics</a></li>
      <li><a href="#performance">Performance</a></li>
      <li><a href="#efficiency">Efficiency</a></li>
      <li><a href="#limitations">Limitations</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="tidyverse">
  <p>multidplyr is a part of the <strong>tidyverse</strong>, an ecosystem of packages designed with common APIs and a shared philosophy. Learn more at <a href="https://tidyverse.org">tidyverse.org</a>.</p>
</div>

<div class="author">
  <p>
    Developed by <a href="http://hadley.nz">Hadley Wickham</a>.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a>.
  </p>
</div>
      </footer>
</div>

  

  </body>
</html>
